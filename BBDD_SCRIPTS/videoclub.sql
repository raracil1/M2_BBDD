SET AUTOCOMMIT=1;

CREATE DATABASE IF NOT EXISTS videoclub;

USE videoclub; 

CREATE TABLE GENERE (
	CodiGenere 	INT(5) PRIMARY KEY, 
	Descripcio 	VARCHAR(15) );

CREATE TABLE ACTOR (
	CodiActor	INT(5) PRIMARY KEY,
	Nom 		VARCHAR(15) ); 

CREATE TABLE PELICULA (
	CodiPeli	INT(5) PRIMARY KEY,
	Titol		VARCHAR(15),
	CodiGenere	INT(5),
	SegonaPart	INT(5),
	CodiActor	INT(5),
	INDEX IDX_PELI_GEN (CodiGenere),
	INDEX IDX_PELI_SEGP (SegonaPart),
	INDEX IDX_PELI_ACT (CodiActor),
        FOREIGN KEY (CodiGenere) REFERENCES GENERE(CodiGenere),
        FOREIGN KEY (SegonaPart) REFERENCES PELICULA(CodiPeli),
        FOREIGN KEY (CodiActor) REFERENCES ACTOR(CodiActor));

CREATE TABLE INTERPRETADA (
	CodiPeli 	INT(5), 
	CodiActor	INT(5),
	PRIMARY KEY (CodiPeli, CodiActor), 
        INDEX IDX_PELIINTERPRETADA (CodiPeli),
        INDEX IDX_ACTORINTERPRETADA (CodiActor),
        FOREIGN KEY (CodiPeli) REFERENCES PELICULA(CodiPeli),
        FOREIGN KEY (CodiActor) REFERENCES ACTOR(CodiActor) );

CREATE TABLE COPIA (
	CodiPeli 	INT(5),
	CodiCopia 	INT(5),
	PRIMARY KEY (CodiPeli, CodiCopia),
	INDEX IDX_COPIA_PELI (CodiPeli),
	FOREIGN KEY (CodiPeli) REFERENCES PELICULA (CodiPeli)  );

CREATE TABLE CLIENT (
	DNI 		CHAR (10) PRIMARY KEY,
	Nom 		VARCHAR(20), 
	Adreca		VARCHAR(20), 
	Telefon 	CHAR (9) );

CREATE TABLE PRESTEC (
	CodiPeli	INT(5), 
	CodiCopia	INT(5), 
	Data		DATE, 
	DNI 		CHAR (10) ,
	PRIMARY KEY (CodiPeli, CodiCopia, Data),
        INDEX IDX_PRESTEC_CLIENT (DNI),
	FOREIGN KEY (DNI) REFERENCES CLIENT(DNI) );

CREATE TABLE FACTURA (
	CodiFactura	INT(5)  PRIMARY KEY,
	Data		DATE, 
	Import		DECIMAL (9,2), 
	DNI 		CHAR (10), 
	INDEX IDX_FACT_DNI (DNI),
	FOREIGN KEY (DNI) REFERENCES CLIENT(DNI) ); 

CREATE TABLE DETALLFACTURA (
	CodiFactura 	INT(5),
	LiniaFactura	INT(5), 
	Descripcio	VARCHAR(15), 
	PreuUnitari	DECIMAL(9,2), 
	NumeroUnitats	INT(5),
	CONSTRAINT DETALL_PK PRIMARY KEY (CodiFactura, LiniaFactura),
	INDEX IDX_DETALL_FACT (CodiFactura),
	FOREIGN KEY (CodiFactura) REFERENCES FACTURA (CodiFactura) ); 


INSERT INTO GENERE VALUES (1, 'Terror');
INSERT INTO GENERE VALUES (2, 'Còmic');
INSERT INTO GENERE VALUES (3, 'Drama');

INSERT INTO ACTOR VALUES (1, 'XXXX');
INSERT INTO ACTOR VALUES (2, 'YYYY');
INSERT INTO ACTOR VALUES (3, 'ZZZZ');

INSERT INTO PELICULA VALUES (1, 'AAAAAAA', 2, NULL, 1);
INSERT INTO PELICULA VALUES (2, 'BBBBBBB', 2, NULL, 1);
INSERT INTO PELICULA VALUES (3, 'CCCCCCC', 1, NULL, 3);
INSERT INTO PELICULA VALUES (4, 'DDDDDDD', 3, NULL, 2);
INSERT INTO PELICULA VALUES (5, 'EEEEEEE', 2, 1, 1);

INSERT INTO INTERPRETADA VALUES (1,1);
INSERT INTO INTERPRETADA VALUES (1,2);
INSERT INTO INTERPRETADA VALUES (2,1);
INSERT INTO INTERPRETADA VALUES (2,2);
INSERT INTO INTERPRETADA VALUES (3,1);
INSERT INTO INTERPRETADA VALUES (4,3);
INSERT INTO INTERPRETADA VALUES (5,3);

INSERT INTO COPIA VALUES (1, 1);
INSERT INTO COPIA VALUES (1, 2);
INSERT INTO COPIA VALUES (2, 1);
INSERT INTO COPIA VALUES (2, 2);
INSERT INTO COPIA VALUES (3, 1);
INSERT INTO COPIA VALUES (3, 2);
INSERT INTO COPIA VALUES (3, 3);
INSERT INTO COPIA VALUES (4, 1);
INSERT INTO COPIA VALUES (5, 1);

INSERT INTO CLIENT VALUES ('011111111Z', 'Pere Puig Roig', NULL, '934444444');
INSERT INTO CLIENT VALUES ('022222222R', 'Maria Catasús Comas', NULL, '555666111');

INSERT INTO PRESTEC VALUES (1, 1, '2009-02-25', '011111111Z');
INSERT INTO PRESTEC VALUES (2, 1, '2009-03-01', '022222222R');
INSERT INTO PRESTEC VALUES (1, 2, '2009-03-02', '022222222R');
INSERT INTO PRESTEC VALUES (2, 2, '2009-03-02', '022222222R');
INSERT INTO PRESTEC VALUES (3, 1, '2009-03-02', '022222222R');

INSERT INTO FACTURA VALUES (1, '2009-03-01', 5.50, '011111111Z');
INSERT INTO FACTURA VALUES (2, '2009-03-02', 4.50, '022222222R');
INSERT INTO FACTURA VALUES (3, '2009-03-06', 13.50, '022222222R');

INSERT INTO DETALLFACTURA VALUES (1, 1, 'PELI1', 5.50, 1);
INSERT INTO DETALLFACTURA VALUES (2, 1, 'PELI2', 4.50, 1);
INSERT INTO DETALLFACTURA VALUES (3, 1, 'PELI1', 5.50, 1);
INSERT INTO DETALLFACTURA VALUES (3, 2, 'PELI3', 4.50, 1);
INSERT INTO DETALLFACTURA VALUES (3, 3, 'Cervesa', 3.50, 2);

